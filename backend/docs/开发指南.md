# PromptWorld 开发指南

## 快速开始

### 1. 环境准备

确保您的系统已安装以下软件：

- **Go 1.21+**: [下载地址](https://golang.org/dl/)
- **MongoDB 4.4+**: [下载地址](https://www.mongodb.com/try/download/community)
- **Git**: [下载地址](https://git-scm.com/downloads)

### 2. 启动MongoDB

#### 方式一：使用Docker（推荐）
```bash
# 拉取并启动MongoDB容器
docker run -d --name promptworld-mongo -p 27017:27017 mongo:latest

# 查看容器状态
docker ps
```

#### 方式二：本地安装
```bash
# macOS
brew services start mongodb-community

# Ubuntu
sudo systemctl start mongod

# Windows
net start MongoDB
```

### 3. 启动项目

```bash
# 进入项目目录
cd promptworld

# 使用启动脚本（推荐）
./start.sh

# 或手动启动
cd backend
go mod tidy
go run main.go
```

### 4. 访问应用

- **前端页面**: http://localhost:8080
- **API文档**: http://localhost:8080/api/v1
- **健康检查**: http://localhost:8080/health

## 项目架构

### 后端架构

```
backend/
├── main.go              # 程序入口，初始化服务器
├── config/
│   └── database.go      # 数据库连接配置
├── models/
│   └── prompt.go        # 数据模型定义
├── controllers/
│   └── prompt_controller.go  # 业务逻辑处理
├── routes/
│   └── routes.go        # 路由配置和中间件
└── utils/
    └── init_data.go     # 初始化示例数据
```

### 前端架构

```
frontend/
├── templates/
│   └── index.html       # 主页模板
├── static/
│   ├── css/
│   │   └── style.css    # 样式文件（毛玻璃效果）
│   └── js/
│       └── app.js       # 前端逻辑（API调用、交互）
```

## API接口文档

### 基础信息

- **Base URL**: `http://localhost:8080/api/v1`
- **Content-Type**: `application/json`
- **字符编码**: `UTF-8`

### 接口列表

#### 1. 获取提示词列表

```http
GET /api/v1/prompts
```

**请求参数**:
```json
{
  "page": 1,        // 页码，默认1
  "limit": 20,      // 每页数量，默认20
  "category": "",   // 分类筛选，可选
  "search": ""      // 搜索关键词，可选
}
```

**响应示例**:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "prompts": [
      {
        "id": "507f1f77bcf86cd799439011",
        "title": "创意文案写作助手",
        "description": "帮助您创作吸引人的营销文案",
        "content": "你是一个专业的文案写作专家...",
        "category": "文案写作",
        "type": "创意写作",
        "tags": ["营销", "创意", "文案"],
        "preview_images": ["https://example.com/image1.jpg"],
        "usage": "直接复制使用，或根据需要调整",
        "likes": 128,
        "comments": 23,
        "rating": 4.8,
        "views": 1520,
        "created_at": "2024-01-15T10:30:00Z",
        "updated_at": "2024-01-15T10:30:00Z"
      }
    ],
    "total": 150,
    "page": 1,
    "limit": 20,
    "total_pages": 8
  }
}
```

#### 2. 获取提示词详情

```http
GET /api/v1/prompts/:id
```

**响应示例**:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "id": "507f1f77bcf86cd799439011",
    "title": "创意文案写作助手",
    "description": "帮助您创作吸引人的营销文案",
    "content": "你是一个专业的文案写作专家...",
    "category": "文案写作",
    "type": "创意写作",
    "tags": ["营销", "创意", "文案"],
    "preview_images": ["https://example.com/image1.jpg"],
    "usage": "直接复制使用，或根据需要调整",
    "likes": 128,
    "comments": 23,
    "rating": 4.8,
    "views": 1521,
    "created_at": "2024-01-15T10:30:00Z",
    "updated_at": "2024-01-15T10:30:00Z"
  }
}
```

#### 3. 获取分类列表

```http
GET /api/v1/categories
```

**响应示例**:
```json
{
  "code": 200,
  "message": "success",
  "data": [
    {
      "name": "文案写作",
      "count": 45
    },
    {
      "name": "图像生成",
      "count": 32
    },
    {
      "name": "代码编程",
      "count": 28
    }
  ]
}
```

## 开发流程

### 1. 添加新功能

#### 后端开发流程：
1. 在 `models/` 中定义数据模型
2. 在 `controllers/` 中实现业务逻辑
3. 在 `routes/routes.go` 中注册路由
4. 测试API接口

#### 前端开发流程：
1. 在 `app.js` 中添加API调用函数
2. 在 `index.html` 中添加UI元素
3. 在 `style.css` 中添加样式
4. 测试用户交互

### 2. 数据库操作

#### 连接数据库
```go
// 在 config/database.go 中
client, err := mongo.Connect(ctx, options.Client().ApplyURI(mongoURI))
```

#### 插入数据
```go
collection := client.Database("promptworld").Collection("prompts")
result, err := collection.InsertOne(ctx, prompt)
```

#### 查询数据
```go
filter := bson.M{"category": category}
cursor, err := collection.Find(ctx, filter)
```

### 3. 前端开发

#### API调用示例
```javascript
// 获取提示词列表
async function fetchPrompts(page = 1, category = '', search = '') {
    const params = new URLSearchParams({
        page: page.toString(),
        limit: '20'
    });
    
    if (category) params.append('category', category);
    if (search) params.append('search', search);
    
    const response = await fetch(`/api/v1/prompts?${params}`);
    const data = await response.json();
    return data;
}
```

#### 动态渲染
```javascript
function renderPrompts(prompts) {
    const container = document.getElementById('prompts-container');
    container.innerHTML = prompts.map(prompt => `
        <div class="prompt-card" onclick="showPromptDetail('${prompt.id}')">
            <h3>${prompt.title}</h3>
            <p>${prompt.description}</p>
            <div class="prompt-meta">
                <span class="category">${prompt.category}</span>
                <span class="likes">❤️ ${prompt.likes}</span>
            </div>
        </div>
    `).join('');
}
```

## 调试指南

### 1. 后端调试

#### 查看日志
```bash
# 启动时查看详细日志
go run main.go

# 或使用调试模式
GIN_MODE=debug go run main.go
```

#### 常见问题

**问题1**: 数据库连接失败
```
解决方案：
1. 检查MongoDB是否启动：docker ps 或 brew services list
2. 检查.env文件中的MONGODB_URI配置
3. 检查防火墙设置
```

**问题2**: 端口被占用
```bash
# 查找占用端口的进程
lsof -i :8080

# 杀死进程
kill -9 <PID>
```

### 2. 前端调试

#### 浏览器开发者工具
1. 按F12打开开发者工具
2. 查看Console面板的错误信息
3. 查看Network面板的API请求
4. 使用Sources面板设置断点

#### 常见问题

**问题1**: API请求失败
```javascript
// 在app.js中添加错误处理
fetch('/api/v1/prompts')
    .then(response => {
        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }
        return response.json();
    })
    .catch(error => {
        console.error('API请求失败:', error);
    });
```

**问题2**: 样式不生效
```
解决方案：
1. 检查CSS文件路径是否正确
2. 清除浏览器缓存（Ctrl+F5）
3. 检查CSS语法错误
```

## 性能优化

### 1. 后端优化

#### 数据库索引
```go
// 为常用查询字段创建索引
collection.Indexes().CreateOne(ctx, mongo.IndexModel{
    Keys: bson.D{{"category", 1}},
})
```

#### 缓存策略
```go
// 使用内存缓存热门数据
var categoryCache = make(map[string][]models.Category)
```

### 2. 前端优化

#### 图片懒加载
```javascript
// 使用Intersection Observer实现懒加载
const imageObserver = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
        if (entry.isIntersecting) {
            const img = entry.target;
            img.src = img.dataset.src;
            imageObserver.unobserve(img);
        }
    });
});
```

#### 防抖搜索
```javascript
// 搜索输入防抖
let searchTimeout;
function handleSearch(query) {
    clearTimeout(searchTimeout);
    searchTimeout = setTimeout(() => {
        fetchPrompts(1, currentCategory, query);
    }, 300);
}
```

## 部署指南

### 1. 开发环境部署

```bash
# 启动开发服务器
./start.sh
```

### 2. 生产环境部署

#### 使用Docker
```dockerfile
# Dockerfile
FROM golang:1.21-alpine AS builder
WORKDIR /app
COPY backend/ .
RUN go mod tidy && go build -o main .

FROM alpine:latest
RUN apk --no-cache add ca-certificates
WORKDIR /root/
COPY --from=builder /app/main .
COPY frontend/ ./frontend/
CMD ["./main"]
```

```bash
# 构建和运行
docker build -t promptworld .
docker run -d -p 8080:8080 promptworld
```

#### 使用Nginx反向代理
```nginx
server {
    listen 80;
    server_name your-domain.com;
    
    location / {
        proxy_pass http://localhost:8080;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
}
```

## 测试指南

### 1. API测试

使用curl测试API：
```bash
# 测试获取提示词列表
curl -X GET "http://localhost:8080/api/v1/prompts?page=1&limit=5"

# 测试获取分类
curl -X GET "http://localhost:8080/api/v1/categories"
```

### 2. 前端测试

在浏览器中测试：
1. 访问 http://localhost:8080
2. 测试搜索功能
3. 测试分类筛选
4. 测试复制功能
5. 测试响应式布局

## 贡献指南

1. Fork项目到您的GitHub账户
2. 创建功能分支：`git checkout -b feature/new-feature`
3. 提交更改：`git commit -am 'Add new feature'`
4. 推送分支：`git push origin feature/new-feature`
5. 创建Pull Request

### 代码规范

#### Go代码规范
- 使用gofmt格式化代码
- 遵循Go官方命名规范
- 添加必要的注释（中文）
- 错误处理要完整

#### 前端代码规范
- 使用2空格缩进
- 变量和函数使用驼峰命名
- 添加必要的注释
- 保持代码简洁易读

## 常见问题FAQ

**Q: 如何添加新的提示词分类？**
A: 直接在数据库中插入新分类的提示词，前端会自动获取并显示。

**Q: 如何修改UI主题色彩？**
A: 修改 `frontend/static/css/style.css` 中的CSS变量。

**Q: 如何增加新的API接口？**
A: 按照MVC模式，在models、controllers、routes中分别添加相应代码。

**Q: 数据库连接失败怎么办？**
A: 检查MongoDB服务状态，确认.env文件配置正确。

如有其他问题，请在GitHub Issues中提出。